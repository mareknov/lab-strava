# AGENTS

This file tells agentic coding tools how to build, test, and contribute to this repository and it sets code-style
expectations.

## Process

1. Read the project README in `docs`
2. Review the requirements and iterations from `docs/iterations`
3. Work on iterations sequentially, one iteration at a time
4. Read iteration `iteration_N` and generate execution plan `plan_N` into `docs/plan`
5. Commit changes iteratively

We will keep adding iterations while we add functionality

FOR EVERY ITERATION ASK ADDITIONAL QUESTIONS TO BUILD GREAT PLAN

## Project structure

- MUST use SpringBoot the best guidelines and practises
- MUST use hexagonal architecture
- MUST decouple shareable functions and common utilities
- MUST include unit tests
- MUST use parametrized tests `@ParameterizedTest` when possible
- MUST generate example HTTP requests in `http` folder by using IntelliJ http client format

### Root package hierarchy

The root package hierarchy is organized as follows:

- `config` Spring config
- `domain` domain features
- `infra` logic and clients that communicate with external systems
- `utils` package for the feature-related code

### Feature package hierarchy

Every feature should be in its own package, named after the feature. The package should contain the following:

- `dto` package for data transfer objects
- `jpa` JPA entity and JPA queries
- `model` domain core models and adapter interfaces
- `service` implementation classes for the business logic
- `validation` validation logic on API and service layer
- `Controller.kt` controller as at the top of a feature package

Model package MUST NOT contain SpringBoot specific annotations.

## Build / lint / test (commands)

- MUST use Gradle
- MUST use linting and formatting with `ktlint`

### Gradle commands

- Full clean + tests: `./gradlew clean check` (runs compilation and tests)
- Run the app: `./gradlew run`
- Run only tests: `./gradlew test`
- Run linting: `./gradlew ktlintCheck` and `./gradlew ktlintFormat` as needed
- Run a single test class: `./gradlew test --tests "com.example.package.MyTestClass"`

### Repository and workflow

- Branching: follow the pattern `iteration_{iterationNumber}`
- No force-push to shared branches; create PRs for code review.
- Do NOT add "Co-Authored-By" lines to commit messages

## Code style guidelines (for agents)

### 1. Formatting and style

- Formatting: use `.editorconfig`
- Imports: avoid wildcard imports (`*`). Keep imports grouped: standard library, third-party, project-local.
- Style: prefer Kotlin-stylefunction/property formatting
- Fluent api: use fluent code style with extension functions wherever possible
- Nullability: prefer non-nullable types and use `?` only when necessary. Use `?.` and `?:` idiomatically.
- Data classes: prefer data classes for simple immutable DTOs.
- Classes and objects: group behavior into classes or objects when it improves testability.

### 2. Naming

- Core domain interfaces: SHOULD have `Use` suffix, for example `BalanceUse`
- Test names: backtick function names: `should do this and that`

### 3. Error handling & nullability

- Use common error format on the HTTP layer
- Translate errors to proper HTTP response codes
- Fail fast: throw exceptions with clear messages for invalid inputs rather than silently swallowing errors.
- Prefer checked handling at boundaries (CLI, file IO) and use unchecked exceptions for programming errors.
- When reading resources (files), ensure streams are closed / use `use` in Kotlin or try-with-resources in Java.
- In Kotlin, prefer sealed or Result types when modeling domain errors if that improves callers' clarity.

### 4. API design / methods

- Small methods: single responsibility principle
- Small, well-named parameters: if a method needs many parameters, prefer an object/DTO instead.
- Pure functions: use pure functions where possible (no hidden side-effects)

### 5. Testing

- Primarily use unit tests
- Test controller with `@WebMvcTest`
- Test edge cases and error handling

## References

- Project README: `docs/README.md`
- Requirements split by iterations: `docs/iterations/`
- Executions plans generated by agent: `docs/plans/`
